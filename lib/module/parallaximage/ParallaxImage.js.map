{"version":3,"names":["React","Component","View","Animated","Easing","ActivityIndicator","findNodeHandle","styles","ParallaxImageStatus","ParallaxImage","constructor","props","state","offset","width","height","status","LOADING","animOpacity","Value","_onLoad","bind","_onError","_measureLayout","setNativeProps","nativeProps","_container","componentDidMount","_mounted","setTimeout","componentWillUnmount","dimensions","carouselRef","nodeHandle","measureLayout","x","y","vertical","sliderHeight","itemHeight","sliderWidth","itemWidth","setState","Math","ceil","event","fadeDuration","onLoad","LOADED","timing","toValue","duration","easing","out","quad","isInteraction","useNativeDriver","start","TRANSITION_FINISHED","onError","ERROR","image","scrollPosition","parallaxFactor","style","AnimatedImageComponent","other","parallaxPadding","requiredStyles","position","dynamicStyles","opacity","transform","translateX","interpolate","inputRange","outputRange","extrapolate","translateY","undefined","spinner","showSpinner","spinnerColor","loaderContainer","render","containerStyle","c","container","Image"],"sources":["ParallaxImage.tsx"],"sourcesContent":["// Parallax effect inspired by https://github.com/oblador/react-native-parallax/\n\nimport React, { Component } from 'react';\nimport {\n    View,\n    Animated,\n    Easing,\n    ActivityIndicator,\n    findNodeHandle,\n    ImageProps,\n    StyleProp,\n    ViewStyle,\n    NativeSyntheticEvent,\n    ImageLoadEventData,\n    ImageErrorEventData\n} from 'react-native';\nimport styles from './ParallaxImage.style';\n\ntype VerticalProps = {\n    vertical: true;\n    sliderHeight: number; // passed from <Carousel />\n    itemHeight: number; // passed from <Carousel />\n}\ntype HorizontalProps = {\n    vertical: false;\n    sliderWidth: number; // passed from <Carousel />\n    itemWidth: number; // passed from <Carousel />\n}\n\ntype ParallaxImageProps = {\n  carouselRef: Parameters<typeof findNodeHandle>[0]; // passed from <Carousel />\n  scrollPosition: Animated.Value | undefined; // passed from <Carousel />\n  containerStyle: StyleProp<ViewStyle>;\n  dimensions?: {\n    width: number;\n    height: number;\n  };\n  fadeDuration: number;\n  parallaxFactor: number;\n  showSpinner: boolean;\n  spinnerColor: string;\n  AnimatedImageComponent: typeof Animated.Image;\n} & ImageProps & (VerticalProps | HorizontalProps);\n\nexport enum ParallaxImageStatus {\n    'LOADING' = 1,\n    'LOADED' = 2,\n    'TRANSITION_FINISHED' = 3,\n    'ERROR' = 4\n}\n\ntype ParallaxImageState = {\n  offset: number;\n  width: number;\n  height: number;\n  status: ParallaxImageStatus;\n  animOpacity: Animated.Value;\n};\n\nexport default class ParallaxImage extends Component<\n  ParallaxImageProps,\n  ParallaxImageState\n> {\n  static defaultProps = {\n      containerStyle: {},\n      fadeDuration: 500,\n      parallaxFactor: 0.3,\n      showSpinner: true,\n      spinnerColor: 'rgba(0, 0, 0, 0.4)',\n      AnimatedImageComponent: Animated.Image\n  };\n\n  _container?: View | null;\n  _mounted?: boolean;\n\n  constructor (props: ParallaxImageProps) {\n      super(props);\n      this.state = {\n          offset: 0,\n          width: 0,\n          height: 0,\n          status: ParallaxImageStatus.LOADING,\n          animOpacity: new Animated.Value(0)\n      };\n      this._onLoad = this._onLoad.bind(this);\n      this._onError = this._onError.bind(this);\n      this._measureLayout = this._measureLayout.bind(this);\n  }\n\n  setNativeProps (nativeProps: { [key: string]: unknown }) {\n    this._container?.setNativeProps(nativeProps);\n  }\n\n  componentDidMount () {\n      this._mounted = true;\n\n      setTimeout(() => {\n          this._measureLayout();\n      }, 0);\n  }\n\n  componentWillUnmount () {\n      this._mounted = false;\n  }\n\n  _measureLayout () {\n      if (this._container) {\n          const {\n              dimensions,\n              carouselRef\n          } = this.props;\n\n          const nodeHandle = findNodeHandle(carouselRef);\n\n          if (carouselRef && nodeHandle) {\n              this._container.measureLayout(\n                  nodeHandle,\n                  (x, y, width, height) => {\n                      const offset = this.props.vertical ?\n                          y - (this.props.sliderHeight - this.props.itemHeight) / 2 :\n                          x - (this.props.sliderWidth - this.props.itemWidth) / 2;\n\n                      this.setState({\n                          offset: offset,\n                          width:\n                dimensions && dimensions.width ?\n                    dimensions.width :\n                    Math.ceil(width),\n                          height:\n                dimensions && dimensions.height ?\n                    dimensions.height :\n                    Math.ceil(height)\n                      });\n                  },\n                  // eslint-disable-next-line @typescript-eslint/no-empty-function\n                  () => {}\n              );\n          }\n      }\n  }\n\n  _onLoad (event: NativeSyntheticEvent<ImageLoadEventData>) {\n      const { animOpacity } = this.state;\n      const { fadeDuration, onLoad } = this.props;\n\n      if (!this._mounted) {\n          return;\n      }\n\n      this.setState({ status: ParallaxImageStatus.LOADED });\n\n      if (onLoad) {\n          onLoad(event);\n      }\n\n      Animated.timing(animOpacity, {\n          toValue: 1,\n          duration: fadeDuration,\n          easing: Easing.out(Easing.quad),\n          isInteraction: false,\n          useNativeDriver: true\n      }).start(() => {\n          this.setState({ status: ParallaxImageStatus.TRANSITION_FINISHED });\n      });\n  }\n\n  // If arg is missing from method signature, it just won't be called\n  _onError (event: NativeSyntheticEvent<ImageErrorEventData>) {\n      const { onError } = this.props;\n\n      this.setState({ status: ParallaxImageStatus.ERROR });\n\n      if (onError) {\n          onError(event);\n      }\n  }\n\n  get image () {\n      const { status, animOpacity, offset, width, height } = this.state;\n      const {\n          scrollPosition,\n          // False positive :( other doesn't have the dimension key\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          dimensions,\n          parallaxFactor,\n          style,\n          AnimatedImageComponent,\n          ...other\n      } = this.props;\n      const parallaxPadding = (this.props.vertical ? height : width) * parallaxFactor;\n      const requiredStyles = { position: 'relative' as const };\n      const dynamicStyles = {\n          width: this.props.vertical ? width : width + parallaxPadding * 2,\n          height: this.props.vertical ? height + parallaxPadding * 2 : height,\n          opacity: animOpacity,\n          transform: scrollPosition ?\n              [\n                  {\n                      translateX: !this.props.vertical ?\n                          scrollPosition.interpolate({\n                              inputRange: [offset - this.props.sliderWidth, offset + this.props.sliderWidth],\n                              outputRange: [-parallaxPadding, parallaxPadding],\n                              extrapolate: 'clamp'\n                          }) :\n                          0\n                  },\n                  {\n                      translateY: this.props.vertical ?\n                          scrollPosition.interpolate({\n                              inputRange: [offset - this.props.sliderHeight, offset + this.props.sliderHeight],\n                              outputRange: [-parallaxPadding, parallaxPadding],\n                              extrapolate: 'clamp'\n                          }) :\n                          0\n                  }\n              ] :\n              []\n      };\n\n      return (\n          <AnimatedImageComponent\n            {...other}\n            style={[styles.image, style, requiredStyles, dynamicStyles]}\n            onLoad={this._onLoad}\n            onError={status !== ParallaxImageStatus.TRANSITION_FINISHED ? this._onError : undefined} // prevent infinite-loop bug\n          />\n      );\n  }\n\n  get spinner () {\n      const { status } = this.state;\n      const { showSpinner, spinnerColor } = this.props;\n\n      return status === ParallaxImageStatus.LOADING && showSpinner ? (\n          <View style={styles.loaderContainer}>\n              <ActivityIndicator\n                size='small'\n                color={spinnerColor}\n                animating={true}\n              />\n          </View>\n      ) : (\n          false\n      );\n  }\n\n  render () {\n      const { containerStyle } = this.props;\n\n      return (\n          <View\n            ref={(c) => {\n                this._container = c;\n            }}\n            pointerEvents='none'\n            style={[containerStyle, styles.container]}\n            onLayout={this._measureLayout}\n          >\n              {this.image}\n              {this.spinner}\n          </View>\n      );\n  }\n}\n"],"mappings":"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"}